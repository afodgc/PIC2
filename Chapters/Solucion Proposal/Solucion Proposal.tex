\fancychapter{Proposed Solucion}
\label{chap:Solucion_Proposal}

\section{System architecture}
    The solar system is mainly composed by a battery, solar panels and several \acp{mppt}. Additionally, the Battery Management system (BMS) and sensors are also relevant to the system, Figure~\ref{fig:sys_architecture}.

    \begin{figure} [!h]
        \centering
        \includegraphics[width=0.70 \textwidth]{Images/Solucional Proposal/System architecture.drawio.pdf}
        \qquad
        \caption{Solar system architecture.}
        \label{fig:sys_architecture}
    \end{figure}

    This project aims to build a \ac{mppt} for \ac{sg01}, which is one of the vessels built by \ac{tsb}, but \ac{tsb} is continuously developing new boats with different batteries and different configurations of solar panels. With that in mind, the final solution needs to be versatile in terms of battery voltage and maximum ratings which will provide savings over the years.

    In terms of batteries, 3 different voltages were used in the past: 12V, 24~V and 48~V. As for solar panels, the biggest solar panel array that \ac{tsb} have ever built had 56 solar cells in series, which in total give a 40.94~V in open circuit and 6.382~A in short circuit (with Maxeon Gen 5 solar cells from SunPower). This will be considered as the limit size of the solar panel and some margin will be added.

    As for the \acs{mppt} controller, it is composed by current and voltage sensing elements to feed the \acs{mppt} algorithm, a power supply cable to ensure steady DC voltage output in the whole range of input voltages, a DC-DC converter alongside with a \acs{mcu} which controls the DC-DC converter taking into account the input measures, Figure~\ref{fig:sys_architecture}.

    The proposed system will use a step-down/up DC-DC converter to ensure load voltage and input voltage flexibility. The exact type is still to be decided. As for the \ac{mppt} algorithm, a simple P\&O will be initial used to simplify the work, however, the prototype needs to support other algorithms for further improvements.

    Thinking on the Look-Up Table (LUT) method, the proposed solution will be able to read both temperature and solar irradiance.

    The communication with the system will be made by \ac{can} communication with 1~Mbit/s of bus speed to connect every \ac{pcb} to the same bus. \acs{can} is the standard communication protocol used by \acs{tsb}, however, when communicating with sensors there is more freedom and every other protocol can be used.

    The prototype will send message to \acs{can} bus with the data measured (voltage, current, temperature and irradiance) as weal as calculated data such as power and electrical efficiency. Also, some additional information can be sent such as status (erro codes, charging, not charging, etc.) or warning about solar panels health.

    Also connected in the \ac{can} bus is the \ac{bms}. The \ac{bms} is the main safety system of the battery. It measures input and output currents, cells temperatures and voltages and decides if the battery is safe to use or not. So the final product does not need to provide these features. However, the safety of the battery is always a priority, so it will be taken into consideration in the proposed solution in the form of protections against overcurrent, overvoltage and reverse polarity. Also, CC-CV charging mode will be used in order to safely charger lithium-ion batteries. 

    \subsection{Requirements summary}
        Taking into account all user requirements and adding some margin, the summary of the requirements is:

        \begin{itemize}
            \item Work with a wide range of battery voltage: from 12~V to 48~V; 
            \item Input maximum rating: 10~A and 50~V;
            \item Electrical efficiency: at least 85~\%;
            \item Fast tracking speed: less than 200~ms;
            \item High track efficiency: close to 100~\% (between 95~\% and 100~\%);   
            \item \ac{can} communication: 1000~Mbit/s and send status, power produced, current, voltage, efficiency and temperature;
            \item Load limits: overcurrent and overvoltage;
            \item Charging technique: CC-CV;
            \item Circuit protection: overcurrent, overvoltage, overtemperature, reverse polarity, ESD, etc.;
            \item MPPT algorithm: support different algorithms;
            
        \end{itemize}

        To successfully complete this project, all the above requirements must be achieved in the final prototype. 


\section{Methodology}
    \subsection{Simulations and design}
        To achieve the requirements, a step-down/up converter needs to be used for versatility. The main purpose is to both convert from low input to high outputs or high inputs and low outputs. Even when the solar panels and battery have similar voltages, the step-down/up converter will be able to achieve the \ac{mpp}. 
        
        After choosing one of the DC-DC converter types, calculations and simulation in Matlab/simulink and LT-spice will be conducted to achieve a high efficient converter.

        As for the algorithm, the final prototype needs to be able to use different algorithms to be future prove and to provide their comparison. Additionally, one new  algorithm can be implemented based on a previous study by António Neves in his master thesis. In this thesis he proposed an algorithm which combines LUT and P\&O but this LUT table only uses voltage and current. It is expected that by adding temperature and/or irradiance we will get better results.

        All the algorithms will be implemented and tested in Matlab/simulink.

        Also, research about how to implement low power consumption voltage and current sensors will be conducted to find a cheap and accrued solution. A few solutions can be simulated in LTspice for precise tuning.

        Finally, before testing the circuit in a proto board or designing the \ac{pcb} in Altium designer to later be manufactured, the microcontroller and sensors will be chosen accordingly to the specifications.      
    
    \subsection{Experimental results}
        To test the circuit in the laboratory, a control environment needs to be built with a closed box and a light emitter device (for example a LED light). Inside this box the irradiance emitted by external sources, like lamps or sun, will be reduced. The light emitter device should achieve irradiance close to the \ac{stc}, which is 1000$\mathrm{w/m}^2$.
        
        The same can be done with the temperature using a simple heater and thermostat to maintain the system at the same temperature or at \ac{stc} conditions, which is 25ºC. 

        This setup provides constant irradiance and temperature but can also provide variations to the environment variables, by changing the irradiance of LEDs with PWM or changing the reference signal of the thermostat. By applying abrupt variations (steps), to one of the variables, the speed of the response and accuracy can be analyzed.

        To eliminate setup errors, an irradiance sensor and a temperature sensor should be installed inside the box for better analyses of the results.

        \textcolor{red}{Add: efficiency tests and robustness tests}





\cleardoublepage
